{% extends 'core/base.html' %}
{% load static %}

{% block title %}{{ hotel.name }} - SL Booking Hotels{% endblock %}

{% block content %}
<div class="container mt-5 mb-5">
    <div class="row">
        <!-- Left Side - Photos & Details -->
        <div class="col-lg-8">
            <!-- Photo Carousel -->
            <div id="hotelCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    {% if hotel.main_image %}<button type="button" data-bs-target="#hotelCarousel" data-bs-slide-to="0" class="active"></button>{% endif %}
                    {% if hotel.photo1 %}<button type="button" data-bs-target="#hotelCarousel" data-bs-slide-to="1"></button>{% endif %}
                    {% if hotel.photo2 %}<button type="button" data-bs-target="#hotelCarousel" data-bs-slide-to="2"></button>{% endif %}
                    {% if hotel.photo3 %}<button type="button" data-bs-target="#hotelCarousel" data-bs-slide-to="3"></button>{% endif %}
                    {% if hotel.photo4 %}<button type="button" data-bs-target="#hotelCarousel" data-bs-slide-to="4"></button>{% endif %}
                </div>
                <div class="carousel-inner rounded shadow">
                    {% if hotel.main_image %}
                        <div class="carousel-item active">
                            <img src="{{ hotel.main_image.url }}" class="d-block w-100" alt="{{ hotel.name }}" style="height: 500px; object-fit: cover;">
                        </div>
                    {% endif %}
                    {% if hotel.photo1 %}
                        <div class="carousel-item">
                            <img src="{{ hotel.photo1.url }}" class="d-block w-100" alt="Photo 1" style="height: 500px; object-fit: cover;">
                        </div>
                    {% endif %}
                    {% if hotel.photo2 %}
                        <div class="carousel-item">
                            <img src="{{ hotel.photo2.url }}" class="d-block w-100" alt="Photo 2" style="height: 500px; object-fit: cover;">
                        </div>
                    {% endif %}
                    {% if hotel.photo3 %}
                        <div class="carousel-item">
                            <img src="{{ hotel.photo3.url }}" class="d-block w-100" alt="Photo 3" style="height: 500px; object-fit: cover;">
                        </div>
                    {% endif %}
                    {% if hotel.photo4 %}
                        <div class="carousel-item">
                            <img src="{{ hotel.photo4.url }}" class="d-block w-100" alt="Photo 4" style="height: 500px; object-fit: cover;">
                        </div>
                    {% endif %}
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#hotelCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#hotelCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon"></span>
                </button>
            </div>

            <!-- Hotel Info -->
            <h1 class="display-5 fw-bold">{{ hotel.name }}</h1>
            <p class="lead"><i class="fas fa-map-marker-alt me-2"></i>{{ hotel.address }}</p>
            <p class="fs-5">{{ hotel.description }}</p>

            <!-- Facilities -->
            {% if hotel.facilities %}
                <h5 class="mt-4">Facilities</h5>
                <div class="row">
                    {% for facility in hotel.facilities %}
                        <div class="col-6 col-md-4 mb-3">
                            <i class="fas fa-check text-success me-2"></i>{{ facility|capfirst }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            <!-- Social Links -->
            <div class="mt-4">
                {% if hotel.owner.profile.phone_number %}
                    <p><strong>Contact Owner:</strong> <a href="tel:{{ hotel.owner.profile.phone_number }}" class="text-primary">{{ hotel.owner.profile.phone_number }}</a></p>
                {% endif %}
                {% if hotel.google_location_link %}
                    <p>
                        <a href="{{ hotel.google_location_link }}" target="_blank" class="btn btn-outline-success btn-sm me-2">
                            <i class="fas fa-map-marker-alt me-2"></i>View on Google Maps
                        </a>
                    </p>
                {% endif %}
                {% if hotel.facebook_page %}
                    <p>
                        <a href="{{ hotel.facebook_page }}" target="_blank" class="btn btn-outline-primary btn-sm">
                            <i class="fab fa-facebook me-2"></i>Visit Facebook Page
                        </a>
                    </p>
                {% endif %}
            </div>

            <!-- Rooms or Full Villa Booking -->
            {% if is_full_villa %}
                <div class="mt-5 text-center p-4 bg-light rounded">
                    <h3>Book Entire Villa</h3>
                    <p class="fs-4 fw-bold text-primary">Rs. {{ hotel.price_per_night }} per night</p>
                    <a href="{% url 'book_villa' hotel.id %}" class="btn btn-success btn-lg">
                        <i class="fas fa-home me-2"></i>Book Entire Villa
                    </a>
                </div>
            {% else %}
                <h3 class="mt-5 mb-4">Available Rooms</h3>
                <div class="row">
                    {% for room in rooms %}
                        <div class="col-md-6 col-lg-4 mb-4">
                            <div class="card shadow-sm h-100">
                                {% if room.image %}
                                    <img src="{{ room.image.url }}" class="card-img-top" alt="{{ room.room_type }}" style="height: 220px; object-fit: cover;">
                                {% else %}
                                    <div class="bg-light text-center py-5" style="height: 220px;">
                                        <i class="fas fa-bed fa-4x text-muted"></i>
                                    </div>
                                {% endif %}
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title">{{ room.room_type }}</h5>
                                    <p class="card-text">
                                        <strong>Room No:</strong> {{ room.room_number }}<br>
                                        <strong>AC Type:</strong> {{ room.get_ac_type_display }}<br>
                                        <strong>Price:</strong> Rs. {{ room.price_per_night }} / night
                                    </p>
                                    <div class="mt-auto">
                                        <a href="{% url 'book_room' room.id %}" class="btn btn-primary w-100">
                                            <i class="fas fa-calendar-check me-2"></i>Book This Room
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% empty %}
                        <div class="col-12 text-center py-5">
                            <p class="text-muted fs-5">No rooms available for this hotel.</p>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- Right Side - Availability Calendar -->
        <div class="col-lg-4">
            <div class="card shadow-sm sticky-top" style="top: 100px;">
                <div class="card-header bg-info text-white text-center">
                    <h5 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>Availability Calendar</h5>
                </div>
                <div class="card-body">
                    <div id="calendar"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- FullCalendar CSS & JS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        height: 'auto',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth'
        },
        events: [
            {% for booking in bookings %}
            {
                start: '{{ booking.check_in|date:"Y-m-d" }}',
                end: '{{ booking.check_out|date:"Y-m-d" }}',
                title: 'Booked',
                backgroundColor: 'red',
                borderColor: 'red',
                textColor: 'white'
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ],
        validRange: {
            start: new Date()
        },
        selectable: false,
        editable: false
    });
    calendar.render();
});
</script>
{% endblock %}