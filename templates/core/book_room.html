{% extends 'core/base.html' %}

{% block title %}Book {{ room.room_number }}{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="display-5 text-primary mb-4">Book Room {{ room.room_number }} at {{ room.hotel.name }}</h1>

    <div class="row">
        <div class="col-md-6">
            {% if room.image %}
                <img src="{{ room.image.url }}" class="img-fluid rounded shadow mb-4" alt="{{ room.room_number }}">
            {% endif %}
        </div>
        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <div class="card-body">
                    <h5 class="card-title text-success">{{ room.room_type }} - {{ room.ac_type }}</h5>
                    <p class="fs-4 fw-bold text-success">LKR {{ room.price_per_night }}/night</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Availability Calendar (හැම booking එකක්ම පේනවා) -->
    <div class="mt-5">
        <h4 class="fw-bold text-primary mb-3">Availability Calendar</h4>
        <div id="room-calendar" class="border rounded p-3 bg-light"></div>
        <p class="text-muted mt-2 small">
            <span class="bg-success text-white px-2 py-1 rounded">Green</span> = Confirmed
            <span class="bg-warning text-dark px-2 py-1 rounded ms-3">Yellow</span> = Pending
            <span class="bg-secondary text-white px-2 py-1 rounded ms-3">Grey</span> = Cancelled
        </p>
    </div>

    <!-- Booking Form -->
    <div class="card shadow-sm mt-5">
        <div class="card-body">
            <form action="{% url 'book_room' room.id %}" method="post">
                {% csrf_token %}
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Check-in Date <span class="text-danger">*</span></label>
                        <input type="date" name="check_in" class="form-control form-control-lg" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Check-out Date <span class="text-danger">*</span></label>
                        <input type="date" name="check_out" class="form-control form-control-lg" required>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary btn-lg w-100">
                            Book This Room
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="text-center mt-4">
        <a href="{% url 'hotel_detail' room.hotel.id %}" class="btn btn-outline-secondary btn-lg">
            <i class="fas fa-arrow-left me-2"></i>Back to Hotel Details
        </a>
    </div>
</div>

<!-- FullCalendar Script -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('room-calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth'
            },
            height: 'auto',
            events: [
                {% for booking in room.booking_set.all %}
                    {
                        title: '{{ booking.get_status_display }}',
                        start: '{{ booking.check_in }}',
                        end: '{{ booking.check_out|date:"Y-m-d" }}',
                        backgroundColor: '{% if booking.status == "confirmed" %}#28a745{% elif booking.status == "pending" %}#ffc107{% else %}#6c757d{% endif %}',
                        borderColor: '{% if booking.status == "confirmed" %}#28a745{% elif booking.status == "pending" %}#ffc107{% else %}#6c757d{% endif %}',
                        textColor: 'white'
                    },
                {% endfor %}
            ]
        });
        calendar.render();
    });
</script>
{% endblock %}